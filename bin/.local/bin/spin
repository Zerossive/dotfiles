#!/usr/bin/env bash
# ==============================================================================
# Script Name: spin
# Description: Displays a loading spinner
# Usage: spin [<type> | help | -h] [<speed>]
# Author: Danny Harris
# ==============================================================================

# -e: exit on error, -u: treat unset variables as errors, -o pipefail: pipe will fail if any command fails
set -euo pipefail

# TODO: make this command accept another command as an argument and run it in the background

# set variables
loading_characters=()
selection="${1:-line}"
speed="${2:-0.1}"

# check for help
if [[ $selection == "help" || $selection == "-h" ]]; then
	cat <<-EOF
		Usage: spin [<type> | help | -h] [<speed>]

		Type:
		    line(default): /
		    star: *
		    dot: â §
		    box: â––
		    barcode: |
		    moon: ğŸŒ˜
		    arrow: â†—
		    circle: â—
		    clock: ğŸ•‘

		Speed is the duration of each character in seconds
	EOF
	exit 0
fi

# if only speed is given, set correct speed & set selection to line
if [[ "$selection" =~ ^[0-9]+([.][0-9]+)?$ ]]; then
	speed="$1"
	selection="line"
fi

# check if speed is a number
if ! [[ "$speed" =~ ^[0-9]+([.][0-9]+)?$ ]]; then
	echo "Invalid speed: $speed"
	exit 1
fi

# choose character set
case $selection in
"line") loading_characters=(\| / - \\) ;;
"star") loading_characters=(Â· â€¢ * â€¢ Â·) ;;
"dot") loading_characters=(â ‹ â ™ â ¹ â ¸ â ¼ â ´ â ¦ â § â ‡ â ) ;;
"box") loading_characters=(â–– â–˜ â– â–—) ;;
"barcode") loading_characters=("|   " "||  " "||| " "||||" "  |||" "   ||" "    |") ;;
"moon") loading_characters=(ğŸŒ‘ ğŸŒ’ ğŸŒ“ ğŸŒ” ğŸŒ• ğŸŒ– ğŸŒ— ğŸŒ˜) ;;
"arrow") loading_characters=(â† â†– â†‘ â†— â†’ â†˜ â†“ â†™) ;;
"circle") loading_characters=(â— â—“ â—‘ â—’) ;;
"clock") loading_characters=(ğŸ• ğŸ•‘ ğŸ•’ ğŸ•“ ğŸ•” ğŸ•• ğŸ•– ğŸ•— ğŸ•˜ ğŸ•™ ğŸ•š ğŸ•›) ;;
"bubble") loading_characters=(â—¯ â—‰ â— â—) ;;
"rectangle") loading_characters=(â–‰ â–Š â–‹ â–Œ â– â– â– â– â– â–Œ â–‹ â–Š â–‰) ;;
*)
	echo "Invalid selection type: $selection"
	exit 1
	;;
esac

# continuously print character sequence
while true; do
	for char in "${loading_characters[@]}"; do
		printf "\r%s\033[K" "$char"
		sleep "$speed"
	done
done

printf "\n"

# vim: set ft=sh:
